text_sensor:
  - platform: homeassistant
    id: id_text_catstuff_list
    entity_id: ${combined_problem_list_entity}
    filters:
      - lambda: |-
            const size_t max_length = 300;
            if(x != "OK")
            {
              std::string str = x;
              if (str.length() > max_length) {
                return str.substr(0, max_length);
              }
              return str;
            }
            else
            {
              return std::string("");
            }

    internal: true
    on_value:
      then:
        - lambda: |-
            // Update the popup message label with the latest catstuff text
            if (!x.empty()) {
              lv_label_set_text(id(id_lv_popup_catstuff_message), x.c_str());
            } else {
              lv_label_set_text(id(id_lv_popup_catstuff_message), "");
            }
